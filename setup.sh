#!/bin/bash

# Sourcebook Generator - ìžë™ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸
# ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì •í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰í•˜ê¸°ë§Œ í•˜ë©´ë©ë‹ˆë‹¤!

echo "ðŸš€ Sourcebook Generator ì„¤ì¹˜ë¥¼ ì‹œìž‘í•©ë‹ˆë‹¤..."
echo ""

# 1. Google Gemini API í‚¤ ì„¤ì •
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "1ë‹¨ê³„: Google Gemini API í‚¤ ì„¤ì •"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ë‹¤ìŒ URLì— ì ‘ì†í•´ì„œ API í‚¤ë¥¼ ë°œê¸‰ë°›ìœ¼ì„¸ìš”: (30ì´ˆ ì •ë„ ì†Œìš”)"
echo "ðŸ‘‰ https://aistudio.google.com/app/apikey"
echo ""
echo "ì•„ëž˜ì™€ ê°™ì´ ë”°ë¼í•˜ì„¸ìš”:"
echo "1. ìœ„ URLì„ ë¸Œë¼ìš°ì €ì—ì„œ ì—´ê¸°"
echo "2. 'Get API key' ë²„íŠ¼ í´ë¦­"
echo "3. 'Create new secret key' í´ë¦­"
echo "4. ë¹¨ê°„ ì½”ë“œë¥¼ ë³µì‚¬ (sk-... í˜•íƒœ)"
echo ""

read -p "API í‚¤ë¥¼ ë°›ìœ¼ì…¨ë‚˜ìš”? (ëŒ€ê¸° ì¤‘...ì—”í„°ë¥¼ ëˆ„ë¥´ì„¸ìš”)"

# 2. .env íŒŒì¼ ìƒì„±
SERVER_DIR="/Users/ext03.2511002/Downloads/sourcebook-generator/server"

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "2ë‹¨ê³„: API í‚¤ë¥¼ .env íŒŒì¼ì— ì €ìž¥"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

read -p "ë³µì‚¬í•œ API í‚¤ë¥¼ ë¶™ì—¬ë„£ê¸° (ë§ˆìš°ìŠ¤ ìš°í´ë¦­ í›„ Paste ì„ íƒ): " API_KEY

if [ -z "$API_KEY" ]; then
    echo "âŒ API í‚¤ê°€ ìž…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤"
    exit 1
fi

# .env íŒŒì¼ ìƒì„±
cat > "$SERVER_DIR/.env" << EOF
GOOGLE_GEMINI_API_KEY=$API_KEY
PORT=5000
FLASK_ENV=production
EOF

echo "âœ… API í‚¤ê°€ ì €ìž¥ë˜ì—ˆìŠµë‹ˆë‹¤!"
echo ""

# 3. Python ì˜ì¡´ì„± ì„¤ì¹˜
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "3ë‹¨ê³„: í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ (ì•½ 1ë¶„ ì†Œìš”)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

cd "$SERVER_DIR"
pip3 install -r requirements.txt

if [ $? -ne 0 ]; then
    echo "âš ï¸  pip3ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•©ë‹ˆë‹¤..."
    python3 -m pip install -r requirements.txt
fi

echo ""
echo "âœ… ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
echo ""

# 4. ì„œë²„ ì‹œìž‘
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "4ë‹¨ê³„: ì„œë²„ ì‹œìž‘"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ðŸ“¡ ì„œë²„ë¥¼ ì‹œìž‘í•©ë‹ˆë‹¤... (http://localhost:5000)"
echo "ðŸ’¾ ë¡œê·¸ë¥¼ í™•ì¸í•˜ë ¤ë©´ ì´ ì°½ì„ ì—´ì–´ë‘” ìƒíƒœë¡œ ìœ ì§€í•˜ì„¸ìš”"
echo ""
echo "ë¸Œë¼ìš°ì €ì—ì„œ ë‹¤ìŒì„ ì—´ì–´ì„œ ì‚¬ìš©í•˜ì„¸ìš”:"
echo "ðŸ‘‰ http://localhost:8000"
echo ""
echo "ì¢…ë£Œí•˜ë ¤ë©´: ì´ í„°ë¯¸ë„ì—ì„œ Ctrl+C (Control + C) ëˆ„ë¥´ê¸°"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# Python Flask ì„œë²„ ì‹œìž‘
cd "$SERVER_DIR"
python3 app.py
